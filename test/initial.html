<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Testing</title>
	<style type="text/css">
		.out {
			background-color: #eee;
			margin: 15px 30px;
		}
	</style>
</head>
<body>
	<h1>Manual Testing environment</h1>
	<div class="out">
		
	</div>
	<script type="text/javascript" src="../dist/scheson.js"></script>
	<script type="text/javascript">
		function getJSON(url, callback) {
			const xhr = new XMLHttpRequest();
			xhr.overrideMimeType("application/json");
		  xhr.onload = function() {
	      if (xhr.readyState === 4) {
	      	console.log('readyState.DONE');
	        if (xhr.status === 200) {
	        	try {
	        		callback(Scheson.jType.parseString(xhr.response));	        		
	        	}
	        	catch(e) {
	        		console.error('error', e, xhr.response);
	        	}
	        } else {
	          console.error(xhr.statusText + ' at ' + url);
	        }
	      }
	      else {
	      	console.log('readyState.nonDONE');
	      }
	    };
	    xhr.open('GET', url, true);
	    xhr.send(null);	
		}
	</script>
	<script type="text/javascript">
		const out = document.getElementsByClassName('out')[0];

		const goods = [
			{ 
				json:	'./object/object-two_props.good1.json',
				schema: './object/object-two_props.schema.json'
			},
			{
				json:	'./string/string-anglo_name.good1.json',
				schema: './string/string-anglo_name.schema.json'
			}
		];
		const bads = [
			{
				json:	'./object-two_props.good1.json',
				schema: './array-anglo_names.schema.json'
			},
			{
				json:	'./array-anglo_names.bad1.json',
				schema: './array-anglo_names.schema.json'
			},
			{
				json:	'./array-anglo_names.good1.json',
				schema: './array-defined_items_opened.schema.json'
			},
		];

		function doValidate(json, schema, jsonUrl, schemaUrl) {
			const validate = Scheson.check(json, schema, true);
			const div = document.createElement('div');
			const txt2 = document.createTextNode(jsonUrl + ' against ' + schemaUrl);
			div.appendChild(txt2);
			const pre = document.createElement('pre');
			const txt = document.createTextNode(JSON.stringify(validate, null, 2));
			pre.appendChild(txt);
			out.appendChild(pre);					
		}
		function errback(url, error) {
			console.error(error + ' in ' + url);
		}
		goods.forEach(function (item) {
			getJSON(item.schema, function(schema) {
				getJSON(item.json, function(json) {
					console.log('json:', json, 'schema:', schema);
					doValidate(json, schema, item.json, item.schema);
				});
			});
		})
	</script>
</body>
</html>